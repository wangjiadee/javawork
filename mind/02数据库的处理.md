###### 1.建表

```mysql
CREATE TABLE `payment` (
  `id` BIGINT (20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `serial` VARCHAR (200) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT '支付流水号',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = INNODB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = '支付表' ROW_FORMAT = DYNAMIC ;


```

###### 2.建立实例类



![image-20210608141218811](C:\Users\80288284\Desktop\Workbench\java_springcloud\mind\img\image-20210608141218811.png)

```java
package com.ralph.springcloud.entities;


import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.io.Serializable;

/**
 * @Description Serializable 用于分布式部署
 * @author 80288284
 */
@Data
@AllArgsConstructor
@NoArgsConstructor

public class Payment implements Serializable {
    private Long id;
    private String serial;
}
```

##### 3.json 分装给前端

```java
package com.ralph.springcloud.entities;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * @author 80288284
 */

@Data
@AllArgsConstructor
@NoArgsConstructor
public class CommonResult<T> {
    /**
     * 404 not found
     */

    private Integer code;
    private String message;
    private T data;


    /**
     * @Description 重写的指定构造器 返回给前端通用的实体
     * @param code 
     * @param message
     */
    public CommonResult(Integer code,String message){
        this(code,message,null);
    }
}

```

##### 4.创建dao接口

直接写实体方法 使用mybatis 直接使用`@Mapper`注解

![image-20210608142936027](C:\Users\80288284\Desktop\Workbench\java_springcloud\mind\img\image-20210608142936027.png)

```java
package com.ralph.springcloud.dao;

import com.ralph.springcloud.entities.Payment;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

/**
 * @author 80288284
 */

@Mapper
public interface PaymentDao {
    public int create(Payment payment);

    public Payment getPaymentById(@Param("id") Long id);
}

```

##### 5.接下来写dao的实现

```yaml
mybatis:
  mapperLocations: classpath:mapper/*.xml
  type-aliases-package: com.ralph.springcloud.entities

```

![image-20210608143259635](C:\Users\80288284\Desktop\Workbench\java_springcloud\mind\img\image-20210608143259635.png)

namesapce 表示映射那些接口

useGeneratedKeys="true"  数据操作成功的返回值

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ralph.springcloud.dao.PaymentDao">
    <!--    这里的useGeneratedKeys是如果创建成功返回1，失败返回0的作用-->
    <insert id="create" parameterType="Payment" useGeneratedKeys="true" keyProperty="id">
        insert into payment(serial) values(#{serial});
    </insert>

    <!--   配置结果集的映射-->
    <resultMap id="BaseResultMap" type="com.ralph.springcloud.entities.Payment">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <id column="serial" property="serial" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="getPaymentById" parameterType="Long" resultMap="BaseResultMap">
        select * from payment where id=#{id};
    </select>

</mapper>

```

##### 6.创建service服务接口和serive的实现类impl

![image-20210608143605262](C:\Users\80288284\Desktop\Workbench\java_springcloud\mind\img\image-20210608143605262.png)

```java
package com.ralph.springcloud.service;

import com.ralph.springcloud.entities.Payment;
import org.apache.ibatis.annotations.Param;

public interface PaymentService {
    public int create(Payment payment);

    public Payment getPaymentById(@Param("id") Long id);
}
```

无脑+@Service注解

```java
package com.ralph.springcloud.service.impl;

import com.ralph.springcloud.dao.PaymentDao;
import com.ralph.springcloud.entities.Payment;
import com.ralph.springcloud.service.PaymentService;
import org.apache.ibatis.annotations.Param;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

/**
 * PaymentServiceImpl 的实现类
 * @author 80288284
 */
@Service
public class PaymentServiceImpl implements PaymentService {
    /**
     * @Resource == @Autowored
     */
    @Resource
    private PaymentDao paymentDao;


    public int create(Payment payment){
        return paymentDao.create(payment);
    }

    public Payment getPaymentById(Long id){
        return paymentDao.getPaymentById(id);
    }
}

```

##### 7.controller 转发类的编写

controller 调用server  server 调用dao

**PS：controller 最后把json体 调用给前端**

```java
package com.ralph.springcloud.controller;

import com.ralph.springcloud.entities.CommonResult;
import com.ralph.springcloud.entities.Payment;
import com.ralph.springcloud.service.PaymentService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;

/**
 * @author 80288284
 */
@Slf4j
@RestController
public class PaymentController {
    @Resource
    private PaymentService paymentService;

    @PostMapping(value = "/payment/create")
    public CommonResult create(Payment payment){
        int result = paymentService.create(payment);
        log.info("[log:] insert result"+result);
        if (result > 0){
            return new CommonResult(200,"insert success!",result);
        }else {
            return new CommonResult(444,"insert failed!",null);
        }
    }


    @GetMapping(value = "/payment/get/{id}")
    public CommonResult getPaymentById(@PathVariable("id") Long id){
        Payment paymentById = paymentService.getPaymentById(id);
        log.info("[log:] query"+paymentById);
        if (paymentById != null){
            return new CommonResult(200,"query success!",paymentById);
        }else {
            return new CommonResult(444,"NONE DATA!"+id,null);
        }
    }
}

```



##### 8.测试

注意点1. 数据库账号密码确认下

注意点2. 数据库操作流程

![image-20210608150215412](C:\Users\80288284\Desktop\Workbench\java_springcloud\mind\img\image-20210608150215412.png)







